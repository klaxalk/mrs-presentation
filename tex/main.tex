\documentclass[aspectratio=1610]{beamer}

%%{ header

\mode<presentation> {

  %%{ themes

  % \usetheme{default}
  % \usetheme{annarbor}
  % \usetheme{antibes}
  % \usetheme{bergen}
  % \usetheme{berkeley}
  % \usetheme{berlin}
  % \usetheme{boadilla}
  % \usetheme{cambridgeus}
  % \usetheme{copenhagen}
  % \usetheme{darmstadt}
  % \usetheme{dresden}
  % \usetheme{frankfurt}
  % \usetheme{goettingen}
  % \usetheme{hannover}
  % \usetheme{ilmenau}
  % \usetheme{juanlespins}
  % \usetheme{luebeck}
  % \usetheme{madrid}
  % \usetheme{malmoe}
  % \usetheme{marburg}
  % \usetheme{montpellier}
  % \usetheme{paloalto}
  % \usetheme{pittsburgh}
  % \usetheme{rochester}
  % \usetheme{singapore}
  % \usetheme{szeged}
  % \usetheme{warsaw}
  % \usetheme{dbt}
  \usetheme{ClassyCharcoal}

  %%}

  %%{ color themes

  % \usecolortheme{albatross}
  % \usecolortheme{beaver}
  % \usecolortheme{beetle}
  % \usecolortheme{crane}
  % \usecolortheme{dolphin}
  % \usecolortheme{dove}
  % \usecolortheme{fly}
  % \usecolortheme{lily}
  % \usecolortheme{orchid}
  % \usecolortheme{rose}
  % \usecolortheme{seagull}
  % \usecolortheme{seahorse}
  % \usecolortheme{whale}
  % \usecolortheme{wolverine}

  %%}

  % \setbeamertemplate{footline} % remove the footer line
  \setbeamertemplate{footline}[page number] % replace the footer line with simple numbers

  \setbeamertemplate{navigation symbols}{} % removing the navigation symbols

  \setbeamertemplate{section in toc}[square] % change the style of entries in the tableofcontents
  \setbeamertemplate{subsection in toc}[square] % change the style of entries in the tableofcontents
}

\usepackage{graphicx} % allows including images
\usepackage{booktabs} % allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage{multimedia}
\newcommand{\superfill}{\vskip0pt plus 1filll}

\usepackage{tikz}
\usepackage{pgfplots}
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
\usepackage{isotope}
\usepackage{transparent} % typesetting units
\usepackage{animate}
\usepackage{adjustbox}
\usepackage{subcaption}
\usepackage{float}
\usepackage{listings}

% load tikz templates
\include{tikz-templates}

%%{ custom commands

\newcommand{\unit}[2]{$#1~\ensuremath{\mathrm{#2}}$}
\newcommand{\strong}[1]{\textbf{#1}}
\newcommand{\coord}[1]{\textbf{#1}}
\newcommand{\norm}[1]{\left\lvert#1\right\rvert}
\newcommand{\m}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\edn}[1]{{\color{blue} \textbf{#1}}}
\newcommand{\todo}[1]{\color{red}{#1}\color{black}}

%%}

\logo{\pgfputat{\pgfxy(0,5)}{\pgfbox[right,base]{\includegraphics[height=0.8cm]{}}}}
\newcommand{\nologo}{\setbeamertemplate{logo}{}}

\usepackage{eso-pic}
\newcommand\AtPagemyUpperLeft[1]{\AtPageLowerLeft{\put(\LenToUnit{0.66\paperwidth},\LenToUnit{0.904\paperheight}){#1}}}
\AddToShipoutPictureFG{
  \AtPagemyUpperLeft{{\includegraphics[height=0.85cm,keepaspectratio]{fig/logo_ctu_fee_mrs_blue.png}}}
}
\newcommand{\AddToShipoutPictureFG}{\setbeamertemplate{logo}{}}

%%}

%%{ TITLE PAGE

\title[]{Unmanned Aerial Platform in the MRS Lab \\ \small{From control theory to application}}

\author[Tomas Baca]{Tomas Baca$^1$, Vojtech Spurny$^1$}
\institute[CTU in Prague]
{
  \\
  \vspace{1em}
  \begin{tiny}
    $^1$Multi-Robot Systems group, Faculty of Electrical Engineering\\
    Czech Technical University in Prague\\
  \end{tiny}
  \medskip
  \textit{tomas.baca@fel.cvut.cz}
}
\date{}

\titlegraphic{\includegraphics[width=5cm]{fig/logo_ctu_fee_mrs_blue.png}}

\begin{document}

\begin{frame}
  \titlepage % Print the title page as the first slide
\end{frame}

% % todo pix its placement on every page
% \logo{%
%   \makebox[1.0\textwidth]{%
%     \hfill%
%     \includegraphics[width=3.0cm, keepaspectratio]{fig/logo_ctu_fee_mrs_blue.png}\vspace{-200pt}
%   }
% }

% \nologo

%%}

%%{ TABLE OF CONTENTS

\begin{frame}
  \frametitle{Outline}
  \tableofcontents
\end{frame}

%%}

%% --------------------------------------------------------------
%% |                   a little bit of history                  |
%% --------------------------------------------------------------

%%{ A little bit of history

\section{A little bit of history}

\begin{frame}
  \frametitle{A little bit of history}

  \only<+>{\begin{block}{$\approx$ 2012, designing custom PCBs for controllers}
      \begin{figure}
        \centering
        \includegraphics[width=0.70\textwidth]{./fig/pcb1.jpg}
      \end{figure}
  \end{block}}

  \only<+>{\begin{block}{$\approx$ 2014, Model Predictive Control on embedded hardware}
      \begin{figure}
        \centering
        \includegraphics[width=0.70\textwidth]{./fig/pcb2.jpg}
      \end{figure}
  \end{block}}

  \only<+>{\begin{block}{$\approx$ 2014, Model Predictive Control on embedded hardware}
      \begin{figure}
        \centering
        \includegraphics[width=0.90\textwidth]{./fig/tricopter.jpg}
      \end{figure}
  \end{block}}

  \only<+>{\begin{block}{Embedded Model Predictive Control}
      \begin{center}
        \movie[externalviewer]{
          \includegraphics[width=0.9\textwidth]{./fig/embedded_mpc_thumbnail.jpg}
        }{../videos/embedded_mpc.mp4}\\
        Video: \url{https://youtu.be/AXI_rkQRBaE}
      \end{center}
  \end{block}}

\end{frame}

\begin{frame}
  \frametitle{A little bit of history}

  \begin{itemize}
    \onslide<1->{\item Custom and purpose-built hardware}
    \onslide<2->{\item Embedded software}
    \onslide<3->{\item Results: \\ Embedded MPC \cite{mmar_mpc}\\ Multi-robot publications: \cite{mmar_spurny}, \cite{auro}}
    \onslide<4->{\item ...}
    \onslide<5->{\item Not Scalable! Bottlenecks everywhere:}
    \onslide<6->{\item Embedded programming \emph{sucks}, simulations are difficult, system is hard to maintain, connecting sensors and peripheries is limited...}
    \onslide<7->{\item ... 2015}
\end{itemize}

\end{frame}

%%}

%%{ Nowadays
\begin{frame}
  \frametitle{Nowadays}

  \begin{block}{A typical pipeline structure revolves around a Linux computer.}
    \begin{figure}
      \includegraphics[width=1.0\textwidth]{./fig/components.png}
    \end{figure}
  \end{block}

\end{frame}
%%}

%% --------------------------------------------------------------
%% |                    UAV control pipeline                    |
%% --------------------------------------------------------------

\section{UAV Control pipeline}
\subsection{control theory point of view}

%%{ UAV control pipepline
\begin{frame}
  \frametitle{Control -- theory POW}

  \begin{figure}
    \begin{adjustbox}{max totalsize={1.0\textwidth}{.85\textheight}, center}
      \input{fig/pipeline_diagram.tex}
    \end{adjustbox}
  \end{figure}

  \begin{block}{\cite{iros}}
    Model Predictive Trajectory Tracking and Collision Avoidance for Reliable Outdoor Deployment of Unmanned Aerial Vehicles, IROS 2018.
  \end{block}

\end{frame}
%%}

\subsection{implementation point of view}

%%{ From theory to practical experiments

%%{ Kalman filter

\begin{frame}
  \frametitle{From theory to practical experiments}

  \begin{columns}[c]

    \onslide<1->{\column{0.48\textwidth} % Left column and width
      \begin{block}{Kalman Filter $\approx$ 10 lines in Matlab}
        \begin{adjustbox}{max totalsize={1.0\textwidth}{.85\textheight}, center}
          \input{fig/kalman.tex}
        \end{adjustbox}
    \end{block}}

    \onslide<2>{\column{0.48\textwidth} % Right column and width
      \begin{block}{Kalman Filter in practice}
        \begin{itemize}
          \item $\ge$ 1000 lines of code
          \item Real-world fusion \& estimation\\
            $\ge$ 5000 lines of code
          \item see \texttt{uav\_core/mrs\_odometry}
        \end{itemize}
    \end{block}}

  \end{columns}

\end{frame}

%%}

%%{ Control

\begin{frame}
  \frametitle{From theory to practical experiments}

  \begin{columns}[c]

    \column{0.48\textwidth} % Left column and width
    \onslide<1->{\vspace{-1em}
      \begin{block}{SO(3) controller $\approx$ 10 lines in Matlab}
        \vspace{-1em}
        \scriptsize{
          \begin{align*}
            \mathbf{m} = &-k_r\mathbf{e}_r-k_\omega \mathbf{e}_\omega + \mathbf{\omega}\times \mathbf{j} \mathbf{\omega} - \hdots \numberthis\\
                         &\hdots - \mathbf{j}\left(\hat{\mathbf{\omega}}\mathbf{r}^t\mathbf{r}_c\mathbf{\omega}_c-\mathbf{r}^t\mathbf{r}_c\dot{\mathbf{\omega}}_c\right)\\
            f = &-(-k_x\mathbf{e}_r - k_{ib}\mathbf{r}\int\limits_0^tr(\tau)^t\mathbf{e}_rd\tau - \hdots \numberthis\\
                &\hdots - k_{iw}\int\limits_0^t\mathbf{e}_rd\tau - k_v\mathbf{e}_v - mg\mathbf{e}_3 + m\ddot{\mathbf{x}}_d)\cdot \mathbf{r}\mathbf{e}_3,
          \end{align*}
        }
        \vspace{-1em}
    \end{block}}

    \onslide<2->{
      \vspace{-0.5em}
      \begin{block}{MPC tracker $\approx$ 20 lines in Matlab}
        \vspace{-1em}
        \scriptsize{
          \begin{align*}
                              & \min_{\mathbf{u}_{[t]}, \mathbf{x}_{[t]}} \label{eq:mpc_cost}\numberthis
                              & & \mathrm{V}\left(\mathbf{x}, \mathbf{u}\right) = \frac{1}{2}\sum_{i=1}^{m-1}\left(\mathbf{e}^T_{[i]}\mathbf{Q}\mathbf{e}_{[i]} + \mathbf{u}^T_{[i]}\mathbf{P}\mathbf{u}_{[i]}\right)
            \end{align*}\begin{align*}
            \text{s.t.}~ \mathbf{x}_{[t+1]} &= \mathbf{A}\mathbf{x}_{[t]} + \mathbf{B}\mathbf{u}_{[t]}, &\forall t &\in \{0, \hdots, m-1\}\numberthis\label{eq:mpc_model}\\
            \mathbf{x}_{[t]} &\leq \mathbf{x\_max}_{[t]}, &\forall t &\in \{1, \hdots, m\}\label{eq:mpc_max}\numberthis\\
            \mathbf{x}_{[t]} &\geq \mathbf{x\_min}_{[t]}, &\forall t &\in \{1, \hdots, m\}\label{eq:mpc_min}\numberthis
          \end{align*}
        }
        \vspace{-1em}
    \end{block}}

    \column{0.48\textwidth} % Right column and width

    \onslide<3>{\begin{block}{Control in practice}
        \begin{itemize}
          \item $\ge$ 10 000 lines of code
        \end{itemize}
    \end{block}}

  \end{columns}

\end{frame}

%%}

%%{ Frame title
\begin{frame}
  \frametitle{From theory to practical experiments}

  \begin{columns}[c]

    \column{0.70\textwidth} % Left column and width
    \begin{block}{What needs to be solved outside of Matlab's sandbox?}
      \begin{itemize}
        \item crashes are expensive, so don't crash
        \item sensors can disconnected during the flight
        \item takeoff and landing: the most tricky part of the flight
        \item mass (thus UAV's model) can change during the flight
        \item controllers can be poorly tuned... handle instabilities
        \item acceleration and speed depends on the available sensors
        \item people are erroneous, don't let the crash the drone
      \end{itemize}
    \end{block}

    \column{0.28\textwidth} % Right column and width
    \begin{block}{The failsafe core}
      \texttt{if (goingToCrash())}\\
      \texttt{~~~~dont();}
    \end{block}

  \end{columns}

\end{frame}
%%}

%%}

%%{ Control pipeline implementation
\begin{frame}
  \frametitle{Control -- implementation POW}

  \centering
  \begin{figure}
    \begin{adjustbox}{max totalsize={1.0\textwidth}{.85\textheight}, center}
      \input{fig/implementation_diagram.tex}
    \end{adjustbox}
  \end{figure}

\end{frame}
%%}

%% --------------------------------------------------------------
%% |                      Linux environment                     |
%% --------------------------------------------------------------

\section{Linux technologies}
\subsection{terminal, shell, TMUX, Vim, ROS}

%%{ Linux terminal & shell

\begin{frame}
  \frametitle{Linux terminal \& shell}

  \begin{block}{A Linux terminal}
    \begin{figure}
      \includegraphics[width=0.9\textwidth]{./fig/terminal.png}
    \end{figure}
  \end{block}

\end{frame}

%%}

%%{ Tmux & Terminal multiplexer

\begin{frame}

  \frametitle{Tmux -- Terminal multiplexer}

  \begin{block}{Tmux in the Linux terminal}
    \begin{figure}
      \includegraphics[width=0.9\textwidth]{./fig/tmux.png}
    \end{figure}
  \end{block}

\end{frame}

%%}

%%{ Vim -- modal, modular, modern

\begin{frame}
  \frametitle{Vim -- modal, modular, modern}

  \begin{block}{Vim in (Tmux in (Linux Terminal)}
    \begin{figure}
      \includegraphics[width=0.9\textwidth]{./fig/vim.png}
    \end{figure}
  \end{block}

\end{frame}

%%}

%%{ Vim -- modal, modular, modern

\begin{frame}
  \frametitle{Vim -- modal, modular, modern}

  \begin{block}{Terminal in (Vim in (Tmux in (Linux Terminal))}
    \begin{figure}
      \includegraphics[width=0.8\textwidth]{./fig/terminal_in_vim.png}
    \end{figure}
  \end{block}

\end{frame}

%%}

%%{ ROS -- Robot Operating System

\begin{frame}
  \frametitle{ROS -- Robot Operating System}

  \begin{itemize}
    \item Middleware allowing communication between programs
    \item Makes the transition from \emph{Matlab} to reality bearable
    \item Supported by sensor manufacturers (lots of ROS drivers)
    \item Integration through the terminal (important, works over ssh)
    \item Handles the difficult stuff nobody that wants to program: time management, logging, recording onboard data, common visualization, parameter loading, static and dynamic transformations, etc.
    \item integrates to robotic simulators: Gazebo, V-REP
  \end{itemize}

  \begin{figure}
    \includegraphics[width=0.3\textwidth]{./fig/ros_logo.png}
  \end{figure}

\end{frame}

%%}

%% | ---------------------- The simulator --------------------- |

\section{MRS simulation stack}

\subsection{Gazebo/ROS, spawn}

%%{ Gazebo/ROS simulator
\begin{frame}
  \frametitle{Gazebo/ROS simulator}

  \begin{figure}
    \includegraphics[width=1.0\textwidth]{./fig/gazebo.png}
  \end{figure}

\end{frame}
%%}

%%{ Spawning drones to the simulator
\begin{frame}
  \frametitle{Spawning drones to the simulator}

  \begin{figure}
    \includegraphics[width=1.0\textwidth]{./fig/spawn.png}
  \end{figure}

\end{frame}
%%}

%% | ------------------- Seminar assignments ------------------ |

\section{Summer School seminar}
\subsection{the MTSPN problem}
\subsection{running the planner, w/ and w/o ROS}

%%{ Seminars' assignemnt -- MTSPN

\begin{frame}
  \frametitle{Seminars' assignment -- MTSPN}

  \begin{columns}[c]

    \column{0.48\textwidth} % Left column and width
    \begin{block}{A sample map of points}
      \includegraphics[width=1.0\textwidth]{./fig/tsp_points.png}
    \end{block}

    \column{0.48\textwidth} % Right column and width
    \begin{block}{Multi-UAV Traveling Salesman Problem with Neighborhoods}
      \begin{itemize}
        \item \unit{2}{m} neighborhood around each point
        \item each point's neighborhood has to be visited by any of the drones
        \item drones' min mutual distance: \unit{5}{m}
        \item faster total time wins
      \end{itemize}
    \end{block}

    \begin{block}{UAV's constraints}
      \begin{itemize}
        \item trajectory sampled at \unit{5}{Hz}
        \item max. speed \unit{7}{m/s}
        \item max. acceleration \unit{2.5}{m/s^2}
        \item UAV's start = finish
      \end{itemize}
    \end{block}

  \end{columns}

\end{frame}

%%}

%%{ An example solution
\begin{frame}
  \frametitle{An example solution of MTSP}

  \begin{figure}
    \includegraphics[width=0.8\textwidth]{./fig/tsp_segments_center.png}
  \end{figure}

\end{frame}
%%}

%%{ With neighborhoods
\begin{frame}
  \frametitle{An example solution with neighborhoods}

  \begin{figure}
    \includegraphics[width=0.8\textwidth]{./fig/tsp_segments.png}
  \end{figure}

\end{frame}
%%}

%%{ Sampled segments
\begin{frame}
  \frametitle{Sampling segments for the UAV's tracker}

  \begin{figure}
    \includegraphics[width=0.8\textwidth]{./fig/tsp_segments_sampled.png}
  \end{figure}

\end{frame}
%%}

%%{ With Dubins
\begin{frame}
  \frametitle{Using the Dubins vehicle model}

  \begin{figure}
    \includegraphics[width=0.8\textwidth]{./fig/tsp_dubins.png}
  \end{figure}

\end{frame}
%%}

%%{ Sampling the Dubins path
\begin{frame}
  \frametitle{Sampling the path for the UAV's tracker}

  \begin{figure}
    \includegraphics[width=0.8\textwidth]{./fig/tsp_dubins_sampled.png}
  \end{figure}

\end{frame}
%%}

\subsection{running the simulation}

%%{ Plotting the trajectory in RVIZ
\begin{frame}
\frametitle{Plotting the trajectory in RVIZ}

  \begin{figure}
    \includegraphics[width=1.0\textwidth]{./fig/rviz_1.png}
  \end{figure}

\end{frame}
%%}

%%{ Plotting the trajectory in RVIZ
\begin{frame}
\frametitle{Showing Results in RVIZ}

  \begin{figure}
    \includegraphics[width=1.0\textwidth]{./fig/rviz_2.png}
  \end{figure}

\end{frame}
%%}

%% --------------------------------------------------------------
%% |                          resources                         |
%% --------------------------------------------------------------

%%{ MRS wiki
\begin{frame}
  \frametitle{MRS wiki}
  \begin{figure}
    \vspace{-1em}
    \caption*{\url{https://mrs.felk.cvut.cz/gitlab/uav/uav_core/wikis/home}}
    \includegraphics[width=0.7\textwidth]{./fig/wiki.png}
  \end{figure}

\end{frame}
%%}

%%{ MRS Cheat Sheet
\begin{frame}
  \frametitle{MRS Cheat Sheet}
  \vspace{-1em}
  \begin{figure}
    \caption*{\url{https://github.com/klaxalk/mrs-cheatsheet}}
    \includegraphics[width=0.8\textwidth]{./fig/mrs_cheatsheet.png}
  \end{figure}

\end{frame}
%%}

%%{ Links
\begin{frame}
  \frametitle{Links}

  \begin{itemize}
    \item Linux setup -- \\\url{https://github.com/klaxalk/linux-setup}
    \item MRS cheat sheet -- \\\url{https://github.com/klaxalk/mrs-cheatsheet}
    \item This presentation -- \\\url{https://github.com/klaxalk/mrs-presentation}
  \end{itemize}

\end{frame}
%%}

%%{ REFERENCES

\begin{frame}
  \frametitle{References}
  \tiny{
    \begin{thebibliography}{99}

      \bibitem[Baca et al., 2016]{mmar_mpc} Baca, T and Loianno, G and Saska, M
      \newblock Embedded Model Predictive Control of Unmanned Micro Aerial Vehicles
      \newblock 2016 IEEE International Conference on Methods and Models in Automation

      \bibitem[Spurny et al., 2016]{mmar_spurny} Spurny, V and Baca, T and Saska, M
      \newblock Complex manoeuvres of heterogeneous MAV-UGV formations using a model predictive control
      \newblock 2016 IEEE International Conference on Methods and Models in Automation

      \bibitem[Saska et al, 2016]{auro} Saska, M and Baca, T and Thomas, J and Chudoba, J and Preucil, L and Krajnik, T and Faigl, J and Loianno, G and Kumar, V
      \newblock System for deployment of groups of unmanned micro aerial vehicles in GPS-denied environments using onboard visual relative localization
      \newblock Autonomous Robots, 2016

      \bibitem[Baca et al., 2018]{iros} Baca, T and Hert, D and Loianno, G and Saska, M and Kumar, V
      \newblock Model Predictive Trajectory Tracking and Collision Avoidance for Reliable Outdoor Deployment of Unmanned Aerial Vehicles
      \newblock 2018 IEEE/RSJ International Conference on Intelligent Robots and Systems

  \end{thebibliography}
}
\end{frame}

%%}

  \end{document}
